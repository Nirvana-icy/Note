---
marp: true
---

### å›¾åƒæ‹æ‘„-åŽ‹ç¼©æµç¨‹ä½“éªŒä¼˜åŒ–

---

## ç†è®º

---
#### å±•ç¤ºä¸€å¼ 590KBçš„å›¾ç‰‡ï¼Œéœ€è¦å ç”¨å¤šå°‘å†…å­˜ï¼Ÿ

![image](./img/Other/image.png)

---

![size](./img/Other/size.png)

---

# 3024 x 4032 x 4 = 46.5MB

---
![memory_use_of_image](./img/Other/memory_use_of_image.png)

---
![DataBuffers](./img/Other/DataBuffers.png)

---
![Decoding](./img/Other/Decoding.png)

---
![ImageBuffers](./img/Other/ImageBuffers.png)

---
![Pipeline](./img/Other/Pipeline.png)

---
![ImageBuffer](./img/Other/ImageBuffer.png)

---
![downSamplingBefore](./img/Other/downSamplingBefore.png)

---
![downSamplingByImageIO](./img/Other/downSamplingByImageIO.png)

---
## é«˜å†…å­˜å ç”¨å¯¹ç³»ç»Ÿçš„å½±å“

---
![lowMemory](./img/Other/lowMemory.png)

---
![highMemory](./img/Other/highMemory.png)

---

## ä¼˜åŒ–å‰åŽæµç¨‹å¯¹æ¯”

```mermaid
sequenceDiagram
    participant ImagePicker
    participant Memory
    participant Disk
    
    ImagePicker->>Memory: 0. Take photo get UIImage
    loop PNGData Convert
        Memory->>Memory: 1. UIImage to PNGData(slow ðŸŒðŸŒðŸŒðŸŒðŸŒðŸŒ)
    end
    Memory->>Disk: 2. PNGData write to Disk(Big data write to disk ðŸŒ )
    note right of Disk: ä¼˜åŒ–å‰æµç¨‹
    Disk-->>Memory: 3. Read PNGData with UIImage
    loop Compress
        Memory->>Memory: 4. UIImage to JPGData with quility(ðŸŒðŸŒ slow)
    end
    loop Resize
        Memory->>Memory: 5. Resize with UIGraphicsImageContext(High Memory Cost ðŸðŸŒðŸŒ )
    end
    loop JPGData Convert
        Memory->>Memory: 6. Resized Image to JPGData with quility(slow ðŸŒ)
    end
    Memory->>Disk: 7. JPGData to Disk 
```

```mermaid
sequenceDiagram
    participant ImagePicker
    participant Memory
    participant Disk

    ImagePicker->>Memory: 0. Take photo get UIImage
    loop JPGData Convert
        Memory->>Memory: 1. UIImage to JPGData with quility(slow ðŸŒðŸŒðŸŒ)
    end
    note right of Disk: ä¼˜åŒ–åŽæµç¨‹
    loop Resize
        Memory->>Memory: 2. Resize with ImageIO(Low Memory Cost ðŸŒ)
    end
    Memory->>Disk: 3. Write to disk with ImageIO with compress
```
---

## Demo

#### åŽ‹ç¼©è¿‡ç¨‹æ•°æ®å¯¹æ¯”

ImageWithName vs ImageWithData

Image è¯»å†™  assest vs bundle

## ä¸šå†…è¿›å±•

---
##### å†·å¯åŠ¨ä¼˜åŒ–

![todo](./img/Other/todo.png)

---

[æŠ–éŸ³å“è´¨å»ºè®¾ - iOSå¯åŠ¨ä¼˜åŒ–ã€ŠåŽŸç†ç¯‡ã€‹](https://mp.weixin.qq.com/s/3-Sbqe9gxdV6eI1f435BDg)

[æŠ–éŸ³å“è´¨å»ºè®¾ - iOSå¯åŠ¨ä¼˜åŒ–ã€Šå®žæˆ˜ç¯‡ã€‹](https://mp.weixin.qq.com/s?__biz=MzI1MzYzMjE0MQ==&mid=2247487757&idx=1&sn=a52c11f6a6f217bd0d3283de9b00c8bc&chksm=e9d0daefdea753f954cfcb15d5d0f90302a9f45ba06968377644ffe9e5757a69c5b0132d2c8b&scene=178&cur_album_id=1568330323321470981#rd)

[è´å£³iOS Appå†·å¯åŠ¨ä¼˜åŒ–](https://ppt.infoq.cn/slide/show?cid=86&pid=3423)

[è„‰è„‰iOSå¦‚ä½•å¯åŠ¨ç§’å¼€](https://mp.weixin.qq.com/s/oUApkX3lpVTga0cEvqLlHQ)

[Trip.com APP å¯åŠ¨ä¼˜åŒ–å®žè·µ](https://mp.weixin.qq.com/s/smWjs2X8HWvcvKW_DSXYJA)

---

#### é•¿æœŸè§†è§’ï¼Œä¸šåŠ¡å¦‚ä½•è·‘çš„åˆå¿«åˆç¨³ï¼Ÿ

ä¸šåŠ¡è¿­ä»£ > ä¸šåŠ¡æž¶æž„ > åŸºç¡€æž¶æž„

---

![issue](./img/Other/issue.png)

---

![optim](./img/Other/optim.png)

---

